name: ðŸš€ Gerar versÃ£o automÃ¡tica completa para o PWA

on:
  push:
    branches:
      - main  # ou 'master' se for o nome do seu branch

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ§¾ Clonar repositÃ³rio com histÃ³rico completo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # ðŸ‘ˆ Importante! Permite ler o histÃ³rico completo do git log

      - name: ðŸ•’ Gerar version.json com dados detalhados
        run: |
          BUILD=$(date +'%Y%m%d%H%M')
          DATA=$(TZ='America/Sao_Paulo' date +'%d/%m/%Y, %Hh%Mmin')
          AUTOR=$(git log -1 --pretty=format:'%an')
          MENSAGEM=$(git log -1 --pretty=format:'%s')

          echo "{" > version.json
          echo "  \"build\": \"${BUILD}\"," >> version.json
          echo "  \"data\": \"${DATA}\"," >> version.json
          echo "  \"autor\": \"${AUTOR}\"," >> version.json
          echo "  \"mensagem\": \"${MENSAGEM}\"" >> version.json
          echo "}" >> version.json

          cat version.json

      - name: ðŸ’¾ Commit e Push do version.json
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config user.name "GitHub Action"
          git config user.email "actions@github.com"
          git add version.json
          git commit -m "ðŸ§± VersÃ£o automÃ¡tica atualizada: $(date +'%Y-%m-%d %H:%M')" || echo "Sem alteraÃ§Ãµes"
          git push https://x-access-token:${GITHUB_TOKEN}@github.com/${{ github.repository }}.git HEAD:${{ github.ref }}
